already experienced in matters of state when he ascended the throne he continued his father s policy of maintaining independence in the face of granada s larger neighbours the christian kingdom of castile and muslim marinid state of morocco as well as an internal rebellion by his family s former allies the banu ashqilula after he took the throne he negotiated a treaty with alfonso x of castile in which castile agreed to end support for the banu ashqilula in exchange for payments when castile took the money but maintained its support for the banu ashqilula muhammad turned towards abu yusuf of the marinids the marinids sent a successful expedition against castile but relations soured when the marinids treated the banu ashqilula as muhammad s equals in 1279 through diplomatic manoeuvring muhammad regained m laga formerly the centre of banu ashqilula power in 1280 his diplomacy backfired when granada faced simultaneous attacks from castile the marinids and the banu ashqilula attacked by his more powerful neighbours muhammad exploited the rift between alfonso and his son sancho as well as receiving help from volunteers of the faith soldiers recruited from north africa the threat subsided when alfonso died in 1284 and